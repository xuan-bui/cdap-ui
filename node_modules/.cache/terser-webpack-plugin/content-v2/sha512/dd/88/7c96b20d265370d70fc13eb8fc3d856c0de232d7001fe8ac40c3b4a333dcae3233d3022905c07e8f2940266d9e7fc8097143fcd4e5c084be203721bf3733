{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{1553:function(e,t,o){\"use strict\";o.d(t,\"a\",(function(){return l}));var n=o(56),r=o(7),a=n.a.getInstance(),s=\"/namespaces/:namespace/apps/:appId/:programType/:programId\",l={get:Object(r.a)(a,\"GET\",\"REQUEST\",s),status:Object(r.a)(a,\"GET\",\"REQUEST\",\"\".concat(s,\"/status\")),runs:Object(r.a)(a,\"GET\",\"REQUEST\",\"\".concat(s,\"/runs\")),pollRuns:Object(r.a)(a,\"GET\",\"POLL\",\"\".concat(s,\"/runs\")),pollStatus:Object(r.a)(a,\"GET\",\"POLL\",\"\".concat(s,\"/status\")),action:Object(r.a)(a,\"POST\",\"REQUEST\",\"\".concat(s,\"/:action\")),stopRun:Object(r.a)(a,\"POST\",\"REQUEST\",\"\".concat(s,\"/runs/:runId/stop\")),pollRunStatus:Object(r.a)(a,\"GET\",\"POLL\",\"\".concat(s,\"/runs/:runId\")),nextLogs:Object(r.a)(a,\"GET\",\"REQUEST\",\"\".concat(s,\"/runs/:runId/logs/next\")),prevLogs:Object(r.a)(a,\"GET\",\"REQUEST\",\"\".concat(s,\"/runs/:runId/logs/prev\"))}},1569:function(e,t,o){\"use strict\";var n=o(72),r=o(73);Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var a=r(o(0)),s=(0,n(o(74)).default)(a.createElement(\"path\",{d:\"M7 10l5 5 5-5z\"}),\"ArrowDropDown\");t.default=s},1616:function(e,t,o){\"use strict\";var n=o(72),r=o(73);Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var a=r(o(0)),s=(0,n(o(74)).default)(a.createElement(\"path\",{d:\"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z\"}),\"ArrowDownward\");t.default=s},1629:function(e,t,o){\"use strict\";o.r(t);var n,r=o(0),a=o(13),s=o.n(a),l=o(45),i=o(1553),c=o(8),g=o(3);!function(e){e.ERROR=\"ERROR\",e.WARN=\"WARN\",e.INFO=\"INFO\",e.DEBUG=\"DEBUG\",e.TRACE=\"TRACE\"}(n||(n={}));var p,u=function(e,t){var o=this;this.includeSystemLogs=!1,this.logLevel=n.INFO,this.getFilter=function(){var e=\"loglevel=\"+o.logLevel;return o.includeSystemLogs||(e=e+\" \"+o.logFilter),e},this.getBaseParams=function(){return{namespace:o.namespace,appId:o.application,programType:o.programType,programId:o.programName,runId:o.runId,max:50,format:\"json\",filter:o.getFilter()}},this.init=function(){return o.getLast()},this.getNext=function(){var e=o.getBaseParams();return o.lastLog&&(e.fromOffset=o.lastLog.offset),i.a.nextLogs(e).map((function(e){return void 0===e&&(e=[]),e.length>0&&(o.lastLog=e[e.length-1]),e}))},this.getPrev=function(){var e=o.getBaseParams();return o.firstLog&&(e.fromOffset=o.firstLog.offset),i.a.prevLogs(e).map((function(e){return void 0===e&&(e=[]),e.length>0&&(o.firstLog=e[0]),e}))},this.getFirst=function(){var e=o.getBaseParams();return i.a.nextLogs(e).map((function(e){return void 0===e&&(e=[]),e.length>0&&(o.firstLog=e[0],o.lastLog=e[e.length-1]),e}))},this.getLast=function(){var e=o.getBaseParams();return i.a.prevLogs(e).map((function(e){return void 0===e&&(e=[]),e.length>0&&(o.firstLog=e[0],o.lastLog=e[e.length-1]),e}))},this.onLogsTrim=function(e,t){o.firstLog=e,o.lastLog=t},this.setIncludeSystemLogs=function(e){return o.includeSystemLogs=e,o.init()},this.getIncludeSystemLogs=function(){return o.includeSystemLogs},this.setLogLevel=function(e){return o.logLevel=e,o.init()},this.getLogLevel=function(){return o.logLevel},this.getDownloadFileName=function(){return[o.namespace,o.application,o.programType,o.programName,o.runId].join(\"-\")},this.getRawLogsUrl=function(){return[\"/v3\",\"namespaces\",o.namespace,\"apps\",o.application,o.programType,o.programName,\"runs\",o.runId,\"logs?escape=false\"].join(\"/\")},this.namespace=e.namespace,this.application=e.application,this.programType=e.programType,this.programName=e.programName,this.runId=e.runId,this.logFilter=t||\"AND .origin=plugin OR .origin=program\"},m=o(197),d=o(6),f=o.n(d),h=o(1616),v=o.n(h),E=o(12),b=o(1569),L=o.n(b),y=o(220),w=o(14),N=o(62),S=function(e,t){var o=\"function\"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,r,a=o.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)s.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}return s},x=s()((function(e){return{root:{backgroundColor:e.palette.grey[900],display:\"flex\",justifyContent:\"flex-end\",alignItems:\"center\",height:\"50px\",paddingLeft:\"20px\",paddingRight:\"20px\",position:\"relative\"},loadingContainer:{marginRight:\"auto\"},actionButton:{margin:e.spacing(1),backgroundColor:e.palette.white[50],color:e.palette.blue[100],\"&:hover\":{color:e.palette.blue[100],backgroundColor:e.palette.white[50]},\"&:focus\":{color:e.palette.blue[100],outline:\"none\",textDecoration:\"none\"},\"&:active\":{color:e.palette.blue[100]},\"&$disabled\":{color:e.palette.grey[50],cursor:\"not-allowed\",backgroundColor:e.palette.white[50]}},downArrow:{marginLeft:\"5px\"},closeButton:{marginLeft:\"30px\",cursor:\"pointer\",fontSize:\"16px\"},disabled:{},checkboxContainer:{margin:\"0 40px\",userSelect:\"none\"},checkbox:{color:e.palette.white[50]},popover:{display:\"inline\",\"& .popper\":{boxShadow:e.shadows[3]}},btnGroup:{display:\"flex\",boxShadow:e.shadows[2],marginLeft:\"8px\",\"& $actionButton\":{margin:0,boxShadow:\"none\"}},downloadBtn:{borderTopRightRadius:0,borderBottomRightRadius:0},dropdownBtn:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:\"1px solid \"+e.palette.grey[300],minWidth:0,paddingLeft:\"5px\",paddingRight:\"5px\",\"&.active\":{backgroundColor:e.palette.blue[300]+\"80\"}}}}))((function(e){var t,o,n=e.classes,a=e.dataFetcher,s=e.isPolling,l=e.getLatestLogs,i=e.setSystemLogs,c=e.onClose,g=e.loading,p=S(r.useState(a.getIncludeSystemLogs()),2),u=p[0],d=p[1];function h(){var e=a.getRawLogsUrl();return\"/downloadLogs?backendPath=\"+encodeURIComponent(e)}return r.createElement(\"div\",{className:n.root,\"data-cy\":\"log-viewer-top-panel\"},r.createElement(E.a,{condition:g},r.createElement(\"div\",{className:n.loadingContainer},r.createElement(N.a,null))),r.createElement(m.a,{variant:\"contained\",className:f()(n.actionButton,(t={},t[n.disabled]=s,t)),disabled:s,onClick:l},\"Scroll to Latest Logs\",r.createElement(v.a,{className:n.downArrow})),r.createElement(m.a,{variant:\"contained\",className:n.actionButton,onClick:function(){var e=!u;d(e),i(e)}},u?\"Hide\":\"View\",\" Advanced Logs\"),r.createElement(\"div\",{className:n.btnGroup},r.createElement(m.a,{variant:\"contained\",className:n.actionButton+\" \"+n.downloadBtn,href:(o=a.getDownloadFileName(),h()+\"&type=download&filename=\"+o+\".log\"),target:\"_blank\"},\"Download All\"),r.createElement(y.a,{target:function(e){var t=e.className;return r.createElement(m.a,{variant:\"contained\",className:t+\" \"+n.actionButton+\" \"+n.dropdownBtn},r.createElement(L.a,null))},modifiers:{preventOverflow:{enabled:!0,boundariesElement:\"viewport\"}},className:n.popover,placement:\"bottom\",showOn:\"Click\"},r.createElement(\"a\",{href:h()+\"&type=raw\",target:\"_blank\"},\"View Raw Logs\"))),r.createElement(E.a,{condition:\"function\"==typeof c},r.createElement(\"span\",{onClick:c,className:n.closeButton,\"data-cy\":\"log-viewer-close-btn\"},r.createElement(w.a,{name:\"icon-close\"}))))})),T=o(125),I=function(){return(I=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},R=function(e,t){var o=\"function\"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,r,a=o.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)s.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}return s},O=[n.ERROR,n.WARN,n.INFO,n.DEBUG,n.TRACE],P=s()((function(e){return{root:{height:\"100%\",display:\"flex\",alignItems:\"center\",lineHeight:\"1.5\"},popoverContainer:{\"& .popper\":{minWidth:\"100px\",width:\"100px\"}},target:{cursor:\"pointer\",display:\"flex\",alignItems:\"center\"},levelRow:{fontSize:\"13px\",display:\"grid\",gridTemplateColumns:\"20px 1fr\",cursor:\"pointer\",textAlign:\"left\",alignItems:\"end\"},selected:{color:e.palette.blue[100]},hovered:{color:e.palette.grey[300]}}}))((function(e){var t=e.classes,o=e.dataFetcher,n=e.changeLogLevel,a=R(r.useState(O.indexOf(o.getLogLevel())),2),s=a[0],l=a[1],i=R(r.useState(null),2),c=i[0],g=i[1];function p(e){var t=O[e];n(t),l(e)}function u(e){return e<=s&&(null===c||e<=c)?t.selected:t.hovered}return r.createElement(\"div\",{className:t.root},r.createElement(y.a,{target:function(e){return r.createElement(\"span\",I({},e,{className:e.className+\" \"+t.target,\"data-cy\":\"log-viewer-log-level-toggle\"}),r.createElement(\"span\",null,\"Level\"),r.createElement(L.a,null))},placement:\"bottom\",className:t.popoverContainer},r.createElement(\"div\",{\"data-cy\":\"log-viewer-log-level-popover\"},O.map((function(e,o){var n=o<=s||o<=c;return r.createElement(\"div\",{className:t.levelRow,key:e,onClick:p.bind(null,o),onMouseEnter:function(){return g(o)},onMouseLeave:function(){return g(null)},\"data-cy\":\"log-level-row-\"+e},r.createElement(\"span\",null,r.createElement(E.a,{condition:n},r.createElement(w.a,{name:\"icon-check\",className:u(o),dataCy:\"log-level-check\"}))),r.createElement(\"span\",null,e))})))))})),C=o(81),F=o.n(C),j=function(){return(j=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},B=s()((function(e){var t=H(e);return{root:j(j({},t.row),{\"&:hover\":{backgroundColor:e.palette.grey[700]}}),cell:t.cell,warn:{color:e.palette.yellow[50]},error:{color:e.palette.red[100]}}}))((function(e){var t,o=e.classes,a=e.logObj,s=new Date(a.log.timestamp),l=F()(s).format(\"L H:mm:ss\"),i=a.log.logLevel;return r.createElement(\"div\",{className:o.root,\"data-cy\":\"log-viewer-row\"},r.createElement(\"div\",{className:o.cell},l),r.createElement(\"div\",{className:f()(o.cell,(t={},t[o.warn]=i===n.WARN,t[o.error]=i===n.ERROR,t))},i),r.createElement(\"div\",{className:o.cell,\"data-cy\":\"log-message\"},a.log.message))})),k=r.memo(B),A=o(134),U=o.n(A),G=o(2),D=o.n(G),_=(p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),W=function(){return(W=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function H(e){return{row:{display:\"grid\",gridTemplateColumns:\"170px 80px 1fr\",borderBottom:\"1px solid \"+e.palette.grey[300],lineHeight:\"30px\",fontSize:\"14px\"},cell:{paddingLeft:\"10px\",paddingRight:\"10px\"}}}var M=function(e){function t(t){var o=e.call(this,t)||this;return o.scrollPosition=0,o.state={logs:[],isFetching:!0,isPolling:!0,error:null,initLoading:!0},o.processFirstResponse=function(e){o.setState({logs:e,initLoading:!1},(function(){o.state.isPolling&&(o.scrollToBottom(),o.watchScroll(),o.setIntersectionObserver(),o.setState({isFetching:!1}),o.pollTimeout=setTimeout(o.startPoll,5e3))}))},o.processError=function(e){var t=Object(g.o)(e),n=\"string\"==typeof t?t:JSON.stringify(t);o.setState({error:n,isPolling:!1,isFetching:!1})},o.dismissError=function(){o.setState({error:null})},o.setIntersectionObserver=function(){var e={root:o.logsContainer.current,rootMargin:\"10px\",threshold:1};o.io=new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting&&1===e.intersectionRatio&&(e.target===o.bottomIndicator.current?o.fetchNext():e.target===o.topIndicator.current&&o.fetchPrev())}))}),e);var t=o.bottomIndicator.current,n=o.topIndicator.current;o.io.observe(t),o.io.observe(n)},o.watchScrollCallback=function(){var e=o.logsContainer.current.scrollTop;e<o.scrollPosition-10&&o.stopPoll(),o.scrollPosition=e},o.watchScroll=function(){o.logsContainer.current.addEventListener(\"scroll\",o.watchScrollCallback)},o.stopScrollWatch=function(){o.logsContainer.current.removeEventListener(\"scroll\",o.watchScrollCallback)},o.scrollToBottom=function(){var e=o.logsContainer.current;e.scrollTop=e.scrollHeight,o.scrollPosition=e.scrollTop},o.startPoll=function(){if(o.props.stopPoll)return o.stopPoll(),void o.fetchNext();o.state.isPolling||o.setState({isPolling:!0}),o.props.dataFetcher.getNext().subscribe((function(e){if(e.length>0){var t=o.state.logs.concat(e);o.setState({logs:t})}o.setState({isFetching:!1},(function(){o.scrollToBottom(),o.trimTopExcessLogs(),o.pollTimeout=setTimeout(o.startPoll,5e3)}))}),o.processError)},o.stopPoll=function(){o.pollTimeout&&(clearTimeout(o.pollTimeout),o.pollTimeout=null),o.state.isPolling&&o.setState({isPolling:!1,isFetching:!1})},o.fetchPrev=U()((function(){if(!o.state.isFetching&&!o.state.isPolling){o.setState({isFetching:!0});var e=o.logsContainer.current,t=e.scrollHeight;o.props.dataFetcher.getPrev().subscribe((function(n){if(n.length>0){var r=n.concat(o.state.logs);o.setState({logs:r})}o.setState({isFetching:!1},(function(){var n=e.scrollHeight;e.scrollTop=n-t;var r=o.state.logs.slice(0,100);o.setState({logs:r}),o.props.dataFetcher.onLogsTrim(r[0],r[o.state.logs.length-1])}))}),o.processError)}}),100),o.fetchNext=U()((function(){o.state.isFetching||o.state.isPolling||(o.setState({isFetching:!0}),o.props.dataFetcher.getNext().subscribe((function(e){if(e.length>0){var t=o.state.logs.concat(e);o.setState({logs:t})}o.setState({isFetching:!1},o.trimTopExcessLogs)}),o.processError))}),100),o.cleanUpWatchers=function(){o.io&&o.io.disconnect(),o.stopScrollWatch(),o.stopPoll()},o.getLatestLogs=function(){o.cleanUpWatchers(),o.setState({isFetching:!0,isPolling:!0,initLoading:!0},(function(){o.props.dataFetcher.getLast().subscribe(o.processFirstResponse,o.processError)}))},o.changeLogLevel=function(e){o.cleanUpWatchers(),o.setState({isFetching:!0,isPolling:!0,initLoading:!0},(function(){o.props.dataFetcher.setLogLevel(e).subscribe(o.processFirstResponse,o.processError)}))},o.setIncludeSystemLogs=function(e){o.cleanUpWatchers(),o.setState({isFetching:!0,isPolling:!0,initLoading:!0},(function(){o.props.dataFetcher.setIncludeSystemLogs(e).subscribe(o.processFirstResponse,o.processError)}))},o.logsContainer=r.createRef(),o.topIndicator=r.createRef(),o.bottomIndicator=r.createRef(),o}return _(t,e),t.prototype.componentDidMount=function(){this.init()},t.prototype.init=function(){this.props.dataFetcher.init().subscribe(this.processFirstResponse,this.processError)},t.prototype.trimTopExcessLogs=function(){var e=this,t=this.logsContainer.current,o=t.scrollHeight-t.scrollTop;this.state.logs.length>100&&this.setState({logs:this.state.logs.slice(this.state.logs.length-100)},(function(){t.scrollTop=t.scrollHeight-o,e.scrollPosition=t.scrollTop,e.props.dataFetcher.onLogsTrim(e.state.logs[0],e.state.logs[e.state.logs.length-1])}))},t.prototype.renderContent=function(){var e=this.props.classes;return this.state.initLoading?r.createElement(\"div\",{className:e.initLoadingContainer},r.createElement(N.a,null)):0===this.state.logs.length?r.createElement(\"div\",{className:e.noLogsContainer},r.createElement(l.b,{type:l.a.h4,label:D.a.translate(\"features.LogViewer.noLogsMessage\"),className:e.noLogsMessage})):r.createElement(r.Fragment,null,this.state.logs.map((function(e,t){return r.createElement(k,{key:e.offset+\"-\"+t,logObj:e})})))},t.prototype.render=function(){var e=this.props.classes;return r.createElement(\"div\",{className:e.root,\"data-cy\":\"log-viewer\"},r.createElement(x,{dataFetcher:this.props.dataFetcher,isPolling:this.state.isPolling,getLatestLogs:this.getLatestLogs,setSystemLogs:this.setIncludeSystemLogs,onClose:this.props.onClose,loading:this.state.isFetching}),r.createElement(\"div\",{className:e.logsTableHeader},r.createElement(\"div\",{className:e.cell},\"Time\"),r.createElement(\"div\",{className:e.cell},r.createElement(P,{dataFetcher:this.props.dataFetcher,changeLogLevel:this.changeLogLevel})),r.createElement(\"div\",{className:e.cell},\"Message\")),r.createElement(\"div\",{className:e.logsContainer,ref:this.logsContainer,\"data-cy\":\"log-viewer-content\"},r.createElement(\"div\",{ref:this.topIndicator,className:e.indicator}),this.renderContent(),r.createElement(\"div\",{ref:this.bottomIndicator,className:e.indicator,id:\"bottom\"})),r.createElement(T.a,{showAlert:!!this.state.error,message:this.state.error,onClose:this.dismissError,type:\"error\"}))},t}(r.PureComponent),Q=s()((function(e){var t=H(e);return{root:{height:\"100%\"},logsTableHeader:t.row,cell:W(W({},t.cell),{fontWeight:\"bold\",lineHeight:\"40px\"}),logsContainer:{height:\"calc(100% - 50px - 40px)\",overflowY:\"auto\",borderBottom:\"1px solid \"+e.palette.grey[200]},indicator:{height:\"1px\",content:\"\"},initLoadingContainer:{textAlign:\"center\",paddingTop:\"25px\"},noLogsContainer:{paddingTop:\"25px\"},noLogsMessage:{textAlign:\"center\"}}}))(M),V=o(27);o.d(t,\"getLogViewerPageUrl\",(function(){return J}));var z=function(e,t){var o=\"function\"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,r,a=o.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)s.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}return s};function J(e,t,o,n,r){return\"/cdap/ns/\"+e+\"/logs/program/\"+t+\"/\"+o+\"/\"+n+\"/\"+r}var $=s()((function(){return{root:{height:\"100%\"},header:{height:\"60px\",padding:\"5px 15px\"},programInfo:{display:\"flex\"},programInfoItem:{marginRight:\"10px\"},infoLabel:{marginRight:\"5px\"},logViewerContainer:{height:\"calc(100% - 60px)\",overflow:\"hidden\"}}}))((function(e){var t=e.classes,o=e.match,n=(void 0===o?{}:o).params,a=n.appId,s=n.programType,p=n.programId,m=n.runId,d=z(r.useState({}),2),f=d[0],h=d[1],v=z(r.useState(!1),2),b=v[0],L=v[1],y=z(r.useState(),2),w=y[0],N=y[1];return r.useEffect((function(){var e={namespace:Object(c.d)(),appId:a,programType:s,programId:p,runId:m},t=i.a.pollRunStatus(e).subscribe((function(e){h(e),-1===[V.g.RUNNING,V.g.STARTING,V.g.STOPPING,V.g.PENDING].indexOf(e.status)&&(L(!0),t.unsubscribe())}));N(new u({namespace:Object(c.d)(),application:a,programType:s,programName:p,runId:m}))}),[]),r.createElement(\"div\",{className:t.root},r.createElement(\"div\",{className:t.header},r.createElement(l.b,{type:l.a.h4,label:\"Logs\"}),r.createElement(\"div\",{className:t.programInfo},r.createElement(\"div\",{className:t.programInfoItem},r.createElement(\"strong\",{className:t.infoLabel},\"App Name:\"),r.createElement(\"span\",null,a)),r.createElement(\"div\",{className:t.programInfoItem},r.createElement(\"strong\",{className:t.infoLabel},\"Program Name:\"),r.createElement(\"span\",null,p)),r.createElement(\"div\",{className:t.programInfoItem},r.createElement(\"strong\",{className:t.infoLabel},\"Status:\"),r.createElement(\"span\",null,f.status)),r.createElement(\"div\",{className:t.programInfoItem},r.createElement(\"strong\",{className:t.infoLabel},\"Start Time:\"),r.createElement(\"span\",null,Object(g.s)(f.starting))),r.createElement(\"div\",{className:t.programInfoItem},r.createElement(\"strong\",{className:t.infoLabel},\"End Time:\"),r.createElement(\"span\",null,Object(g.s)(f.end))))),r.createElement(E.a,{condition:!!w},r.createElement(\"div\",{className:t.logViewerContainer},r.createElement(Q,{dataFetcher:w,stopPoll:b}))))}));t.default=$}}]);","extractedComments":[]}